//- DEV: Designed after:
//-   Large: https://app.moqups.com/todd@findwork.co/noWM1oiRBn/edit/page/a83fa0086
//-   Medium: https://app.moqups.com/todd@findwork.co/noWM1oiRBn/edit/page/a03ef4dcc
//-   Small: https://app.moqups.com/todd@findwork.co/noWM1oiRBn/edit/page/a541249ff
extends layout
include application-mixins

block title
  title Application - #{selectedApplication.name} - Find Work

block content
  h1.content__heading(style="font-weight: normal") Job application
  h2.content__subheading(style="font-weight: normal")
    = selectedApplication.name
    //- DEV: On large screens, display "All changes saved" away from content
    i.text--normal.float--right.muted.medium-and-down-hidden(data-autosave) All changes saved
  //- DEV: We wanted to use a `p` but we can't nest forms in them
  //-   as browsers break up those block in block formations
  .action-bar.push--bottom
    .action-bar__info
      = "Status: "
      b= selectedApplication.human_status
    .action-bar__actions.btn-group
      .large-hidden Actions:
      if selectedApplication.status === APPLICATION_STATUSES.WAITING_FOR_RESPONSE
        a.action.btn.btn--thin.btn--default.btn--first(href=selectedApplication.add_interview_url)
          span.small-hidden(aria-hidden="true")= "+ "
          | Add interview
        //- DESIGN: On load of next page, add a confetti animation
        //-   https://app.moqups.com/todd@findwork.co/noWM1oiRBn/edit/page/a83fa0086
        //- DESIGN: On load of next page, have indication that we preselected 7 day response reminder
        //-   https://app.moqups.com/todd@findwork.co/noWM1oiRBn/edit/page/a83fa0086
        //- TODO: Reuse application save URL and pass a hidden `input(name=action, value="received-offer")`
        form(method="POST", action=selectedApplication.received_offer_url, style="display: inline")
          +csrf-input()
          button.action.btn.btn--thin.btn--default.btn--middle(type="submit")
            span.small-hidden I've received an offer
            span.medium-and-up-hidden Received offer
        //- DESIGN: On click, redirect to unselected nav and add notification for "Application has been archived"
        //-   https://app.moqups.com/todd@findwork.co/noWM1oiRBn/edit/page/a83fa0086
        form(method="POST", action=selectedApplication.archive_url, style="display: inline")
          +csrf-input()
          button.action.btn.btn--thin.btn--default.btn--last(type="submit")
            span.small-hidden Archive application
            span.medium-and-up-hidden Archive
      else if selectedApplication.status === APPLICATION_STATUSES.ARCHIVED
        form(method="POST", action=selectedApplication.restore_url, style="display: inline")
          +csrf-input()
          button.action.btn.btn--thin.btn--default(type="submit")
            | Restore application
      else
        - throw new Error('Unexpected application status');
  p.large-hidden
    //- DEV: On small screens, display "All changes saved" close to content
    i.muted(data-autosave) All changes saved
  .cf
    form(method="POST", action=selectedApplication.url)
      +csrf-input()
      .grid
        .grid__item.one-whole.medium-one-half.large-four-ninths
          +posting-url-and-name(selectedApplication)
        .grid__item.one-whole.medium-one-half.large-five-ninths.company-notes-and-research__container
          +company-notes-and-research(selectedApplication)
        .grid__item.one-whole.medium-one-half.large-four-ninths
          .form-group
            label(for="application_date")
              //- TODO: Is text "Applied on" or "Application date" (I think it's "Applied on" for "Add" and "Application date" for "Edit")
              = "Application date: "
              i.fa.fa-calendar-o(style="font-size: 1.5em")
            //- TODO: Explore using full datetime so we can capture timezone
            +datepicker(selectedApplication.application_date_moment)#application_date.form-control(name="application_date")
          .form-group
            //- TODO: Make sure we are consistent with "Follow-up" vs "Follow up"
            h4.flush--bottom(style="font-weight: normal")
              = "Follow up reminder: "
              span.text--normal
                i.fa.fa-reply(style="font-size: 1.5em")
            //- TODO: Handle default moment
            +reminderpicker("follow_up_reminder", selectedApplication.follow_up_reminder_moment)
          div.past-interviews
            //- TODO: Design our empty state for this...
            h4.push-half--bottom(style="font-weight: normal")
              = "Past interviews: "
              a.text--normal.btn.btn--small.btn--default(href=selectedApplication.add_interview_url)
                span(aria-hidden="true")= "+ "
                | Add interview
            p.landmark
              each past_interview, i in selectedApplication.past_interviews
                //- Fri Jan 15 at 9:00AM PST
                a(href=past_interview.url)= past_interview.moment.format('ddd MMM D [at] h:mmA zz')
                if i != selectedApplication.past_interviews.length - 1
                  br
          if selectedApplication.status == APPLICATION_STATUSES.ARCHIVED
            .landmark.archive-date(style="margin-top: -18px")
              h4.push-half--bottom(style="font-weight: normal")
                = "Archive date: "
                i.fa.fa-calendar-o(style="font-size: 1.5em")
              span= selectedApplication.archived_at_moment.format('ddd MMM D [at] h:mmA zz')
          p.large-hidden(style="margin-top: -18px")
            //- DEV: On small screens, display "All changes saved" close to content
            i.muted(data-autosave) All changes saved
          div.landmark
            button.btn.btn--primary(type="submit") Save changes
    form.landmark.float--left(method="POST", action=selectedApplication.delete_url)
      +csrf-input()
      //- DEV: We can resolve nested form issue by moving to a modal
      //-   Currently, we resolved it via floats
      //- TODO: Add test that verifies form doesn't submit on confirm rejection
      button.btn.btn--danger(type="submit", onclick="javascript:return confirm('Are you sure you want to delete #{selectedApplication.name}?')") Delete
