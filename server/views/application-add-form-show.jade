extends layout
include application-mixins
include interview-mixins

block title
  //- Resolve human status
  //- DEV: This must be done in a block, otherwise it's inaccessible
  - assert(status_key);
  - var status = APPLICATION_STATUSES[status_key];
  - var humanStatus = APPLICATION_ADD_HUMAN_STATUSES[status_key];
  title Add job application - #{humanStatus} - Find Work

//- DEV: We cannot share all content with edit page (e.g. it lacks interview fields for upcoming interview)
block content
  h1.content__heading(style="font-weight: normal") Add job application
  h2.content__subheading(style="font-weight: normal")
    | Please fill out information about the application
  //- Fallback submission data for initial renders
  - var submissionData = {};
  form.cf(method="POST", action=page_url)
    +csrf-input()
    .action-bar.push--bottom
      .action-bar__info
        //- DEV: Id is for testing only
        span#application-status
          = "Status: "
          b= humanStatus
    .grid
      .grid__item.one-whole.medium-one-half.large-four-ninths
        .form-group
          label(for="name")
            = "Name: (if empty, autofilled from URL)"
          input#name.form-control.input--block(name="name", type="text", value=submissionData.name, placeholder="Examples: Google, Acme Corp")
        +posting-url(submissionData)
        if status !== APPLICATION_STATUSES.SAVED_FOR_LATER
          +application-date(submissionData)
      .grid__item.one-whole.medium-one-half.large-five-ninths.company-notes-and-research__container
        +company-notes-and-research(submissionData)
      .grid__item.one-whole.medium-one-half.large-four-ninths
        if status === APPLICATION_STATUSES.SAVED_FOR_LATER
          +application-reminder(submissionData, {showInfo: true})
        else if status === APPLICATION_STATUSES.WAITING_FOR_RESPONSE
          +follow-up-reminder(submissionData, {showInfo: true})
        else if status === APPLICATION_STATUSES.UPCOMING_INTERVIEW
          h4.push-half--bottom(style="font-weight: normal") Interview information:
          //- DEV: We could shift follow up dates with application info but
          //-   it's sanest to keep relevant/changing info next to each other
          //- TODO: Hide reminders when people have seen them before
          +interview-fields(submissionData, {showInfo: true})
        else if status === APPLICATION_STATUSES.RECEIVED_OFFER
          +offer-response-reminder(submissionData, {showInfo: true})
        else
          throw new Error('Unrecognized status "' + status + '"');
        p.push-triple--bottom
          button.btn.btn--primary(type="submit")
            | Save job application
            if status === APPLICATION_STATUSES.UPCOMING_INTERVIEW
              = " and interview"
        p
          a.btn.btn--default(href="javascript:window.history.go(-1);") Go back to previous screen
